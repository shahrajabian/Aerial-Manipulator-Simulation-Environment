import numpy as np
from math import * 

def get_Mq(q, qDot, params):

	g, mb, mL0, mL1, mL2, mL3, d, d0, d1, d2, d3 = \
		params['g'], params['mb'], params['mL0'], params['mL1'], params['mL2'], params['mL3'], params['d'], params['d0'], params['d1'], params['d2'], params['d3']
	Ixx, Iyy, Izz, Ix0, Iy0, Iz0, Ix1, Iy1, Iz1, Ix2, Iy2, Iz2, Ix3, Iy3, Iz3 = \
		params['Ixx'], params['Iyy'], params['Izz'], params['Ix0'], params['Iy0'], params['Iz0'], params['Ix1'], params['Iy1'], params['Iz1'], params['Ix2'], params['Iy2'], params['Iz2'], params['Ix3'], params['Iy3'], params['Iz3']
	X, Y, Z, phi, theta, psi, n1, n2, n3 = \
		q[0], q[1], q[2], q[3], q[4], q[5], q[6], q[7], q[8] 
	XDot, YDot, ZDot, phiDot, thetaDot, psiDot, n1Dot, n2Dot, n3Dot = \
		qDot[0], qDot[1], qDot[2], qDot[3], qDot[4], qDot[5], qDot[6], qDot[7], qDot[8] 
	Mq = np.zeros((9,9)) 

	x0 = mL0 + mL1 + mL2 + mL3 + mb
	x1 = sin(psi)
	x2 = cos(phi)
	x3 = x1*x2
	x4 = cos(theta)
	x5 = x4**2
	x6 = d0/2
	x7 = x5*x6
	x8 = sin(theta)
	x9 = x8/2
	x10 = sin(phi)
	x11 = cos(psi)
	x12 = x10*x11
	x13 = x1*x2*x8 - x12
	x14 = d0*x13
	x15 = x14*x9 + x3*x7
	x16 = mL0*x15
	x17 = cos(n1)
	x18 = d1*x17
	x19 = sin(n1)
	x20 = d1*x19
	x21 = x20/2
	x22 = d0 + x21
	x23 = x18*x9 - x2*x22*x4
	x24 = -x23
	x25 = x1*x4
	x26 = x18/2
	x27 = x13*x22 + x25*x26
	x28 = -x27
	x29 = x24*x25 - x28*x8
	x30 = mL1*x29
	x31 = n1 + n2
	x32 = d2*cos(x31)
	x33 = x32/2
	x34 = x18 + x33
	x35 = d2*sin(x31)
	x36 = x35/2
	x37 = x20 + x36
	x38 = d0 + x37
	x39 = -x2*x38*x4 + x34*x8
	x40 = -x39
	x41 = x13*x38 + x25*x34
	x42 = -x41
	x43 = x25*x40 - x42*x8
	x44 = mL2*x43
	x45 = n3 + x31
	x46 = d3/2
	x47 = x46*cos(x45)
	x48 = x32 + x47
	x49 = x18 + x48
	x50 = x46*sin(x45)
	x51 = x35 + x50
	x52 = x20 + x51
	x53 = d0 + x52
	x54 = -x2*x4*x53 + x49*x8
	x55 = -x54
	x56 = x13*x53 + x25*x49
	x57 = -x56
	x58 = x1*x4*x55 - x57*x8
	x59 = mL3*x58
	x60 = x16 + x30 + x44 + x59
	x61 = x11*x2
	x62 = x4*x61
	x63 = mL0/2
	x64 = x11*x24
	x65 = x11*x40
	x66 = x11*x55
	x67 = d0*x62*x63 + mL1*x64 + mL2*x65 + mL3*x66
	x68 = mL1*x28
	x69 = mL2*x42
	x70 = mL3*x57
	x71 = -x14*x63 + x68 + x69 + x70
	x72 = x11*x4
	x73 = x1*x10
	x74 = x61*x8 + x73
	x75 = -x21*x72 + x26*x74
	x76 = mL1*x75
	x77 = -x37
	x78 = x34*x74 + x72*x77
	x79 = mL2*x78
	x80 = -x52
	x81 = x49*x74 + x72*x80
	x82 = mL3*x81
	x83 = x76 + x79 + x82
	x84 = x33*x74 - x36*x72
	x85 = mL2*x84
	x86 = -x51
	x87 = x48*x74 + x72*x86
	x88 = mL3*x87
	x89 = x85 + x88
	x90 = x47*x74 - x50*x72
	x91 = mL3*x90
	x92 = d0*x74
	x93 = -x61*x7 - x9*x92
	x94 = mL0*x93
	x95 = x22*x74 + x26*x72
	x96 = x23*x72 - x8*x95
	x97 = mL1*x96
	x98 = x34*x72 + x38*x74
	x99 = x39*x72 - x8*x98
	x100 = mL2*x99
	x101 = x49*x72 + x53*x74
	x102 = -x101*x8 + x11*x4*x54
	x103 = mL3*x102
	x104 = x100 + x103 + x94 + x97
	x105 = x1*x23
	x106 = x1*x39
	x107 = x1*x54
	x108 = d0*mL0*x1*x2*x4/2 - mL1*x105 - mL2*x106 - mL3*x107
	x109 = mL1*x95
	x110 = mL2*x98
	x111 = mL3*x101
	x112 = x109 + x110 + x111 + x63*x92
	x113 = x13*x26 - x21*x25
	x114 = mL1*x113
	x115 = x13*x34 + x25*x77
	x116 = mL2*x115
	x117 = x13*x49 + x25*x80
	x118 = mL3*x117
	x119 = x114 + x116 + x118
	x120 = x13*x33 - x25*x36
	x121 = mL2*x120
	x122 = x13*x48 + x25*x86
	x123 = mL3*x122
	x124 = x121 + x123
	x125 = x13*x47 - x25*x50
	x126 = mL3*x125
	x127 = x1*x74
	x128 = x4*x6
	x129 = d0*x11*x13*x4/2 - x127*x128
	x130 = mL0*x129
	x131 = -x95
	x132 = x131*x25 + x27*x72
	x133 = mL1*x132
	x134 = -x98
	x135 = x134*x25 + x41*x72
	x136 = mL2*x135
	x137 = -x101
	x138 = x137*x25 + x56*x72
	x139 = mL3*x138
	x140 = x130 + x133 + x136 + x139
	x141 = x92/2
	x142 = x14/2
	x143 = -x1*x142 - x11*x141
	x144 = -x1*x27 + x11*x131
	x145 = mL1*x144
	x146 = -x1*x41 + x11*x134
	x147 = mL2*x146
	x148 = -x1*x56 + x11*x137
	x149 = mL3*x148
	x150 = mL0*x143 + x145 + x147 + x149
	x151 = x2*x4
	x152 = x151*x26 + x21*x8
	x153 = x2*x34*x4 - x77*x8
	x154 = mL2*x153
	x155 = x2*x4*x49 - x8*x80
	x156 = mL3*x155
	x157 = mL1*x152 + x154 + x156
	x158 = x151*x33 + x36*x8
	x159 = x2*x4*x48 - x8*x86
	x160 = mL3*x159
	x161 = mL2*x158 + x160
	x162 = x151*x47 + x50*x8
	x163 = mL3*x162
	x164 = x8**2
	x165 = x1**2
	x166 = x165*x5
	x167 = x11**2
	x168 = x167*x5
	x169 = x164 + x166 + x168
	x170 = x169*x8
	x171 = x10*x4
	x172 = x171*x8
	x173 = x61 + x73*x8
	x174 = -x1*x2 + x12*x8
	x175 = -x172 + x173*x25 + x174*x72
	x176 = Iy0*x175
	x177 = x13*x25 - x151*x8 + x72*x74
	x178 = Iz0*x177
	x179 = -Ix0*x170 + x151*x178 + x171*x176
	x180 = Iyy*x175
	x181 = Izz*x177
	x182 = -Ixx*x170 + x151*x181 + x171*x180
	x183 = Ix1*x170
	x184 = -x174
	x185 = -x173
	x186 = x172 + x184*x72 + x185*x25
	x187 = Iz1*x186
	x188 = x171*x187
	x189 = Iy1*x177*x2*x4 - x183 - x188
	x190 = Ix0*x169
	x191 = x13*x178 + x173*x176 + x190*x25
	x192 = x174*x176 + x178*x74 + x190*x72
	x193 = Ixx*x169
	x194 = x13*x181 + x173*x180 + x193*x25
	x195 = x174*x180 + x181*x74 + x193*x72
	x196 = Ix1*x169
	x197 = Iy1*x177
	x198 = x184*x187 + x196*x72 + x197*x74
	x199 = x13*x197 + x185*x187 + x196*x25
	x200 = Iz2*x186
	x201 = x151*x19 - x17*x8
	x202 = x17*x72 + x19*x74
	x203 = x13*x19 + x17*x25
	x204 = Ix2*(-x201*x8 + x202*x72 + x203*x25)
	x205 = x151*x17 + x19*x8
	x206 = x17*x74 - x19*x72
	x207 = x13*x17 - x19*x25
	x208 = Iy2*(-x205*x8 + x206*x72 + x207*x25)
	x209 = -x171*x200 + x201*x204 + x205*x208
	x210 = x184*x200 + x202*x204 + x206*x208
	x211 = x185*x200 + x203*x204 + x207*x208
	x212 = Iz3*x186
	x213 = sin(n2)
	x214 = cos(n2)
	x215 = x17*x214 - x19*x213
	x216 = x17*x213 + x19*x214
	x217 = x2*x216*x4 - x215*x8
	x218 = x215*x72 + x216*x74
	x219 = x13*x216 + x215*x25
	x220 = Ix3*(-x217*x8 + x218*x72 + x219*x25)
	x221 = -x216
	x222 = x151*x215 - x221*x8
	x223 = x215*x74 + x221*x72
	x224 = x13*x215 + x221*x25
	x225 = Iy3*(-x222*x8 + x223*x72 + x224*x25)
	x226 = -x171*x212 + x217*x220 + x222*x225
	x227 = x184*x212 + x218*x220 + x223*x225
	x228 = x185*x212 + x219*x220 + x224*x225
	x229 = -x100*x106 - x103*x107 - x105*x97 + x128*x16*x61 + x128*x3*x94 + x130*x143 + x133*x144 + x136*x146 + x139*x148 + x30*x64 + x44*x65 + x59*x66
	x230 = x100*x98 + x101*x103 + x141*x94 - x142*x16 + x28*x30 + x42*x44 + x57*x59 + x95*x97
	x231 = -x171*x226 + x184*x227 + x185*x228
	x232 = -x171*x209 + x184*x210 + x185*x211 + x231
	x233 = x100*x115 + x103*x117 + x113*x97 + x133*x152 + x136*x153 + x139*x155 + x30*x75 + x44*x78 + x59*x81
	x234 = x100*x120 + x103*x122 + x136*x158 + x139*x159 + x44*x84 + x59*x87
	x235 = x103*x125 + x139*x162 + x59*x90
	x236 = -x1*x174 + x11*x173
	x237 = Iy0*x236
	x238 = x11*x13 - x127
	x239 = Iz0*x238
	x240 = x151*x239 + x171*x237
	x241 = Iy1*x238
	x242 = -x1*x184 + x11*x185
	x243 = Iz1*x242
	x244 = x151*x241 - x171*x243
	x245 = Iyy*x236
	x246 = Izz*x238
	x247 = x151*x246 + x171*x245
	x248 = Iz2*x242
	x249 = Ix2*(-x1*x202 + x11*x203)
	x250 = Iy2*(-x1*x206 + x11*x207)
	x251 = -x171*x248 + x201*x249 + x205*x250
	x252 = Iz3*x242
	x253 = Ix3*(-x1*x218 + x11*x219)
	x254 = Iy3*(-x1*x223 + x11*x224)
	x255 = -x171*x252 + x217*x253 + x222*x254
	x256 = x13*x239 + x173*x237
	x257 = x174*x237 + x239*x74
	x258 = x184*x243 + x241*x74
	x259 = x13*x241 + x185*x243
	x260 = x13*x246 + x173*x245
	x261 = x174*x245 + x246*x74
	x262 = x184*x248 + x202*x249 + x206*x250
	x263 = x185*x248 + x203*x249 + x207*x250
	x264 = x184*x252 + x218*x253 + x223*x254
	x265 = x185*x252 + x219*x253 + x224*x254
	x266 = x2**2
	x267 = d0**2*mL0/4
	x268 = x266*x267
	x269 = -x105*x109 - x106*x110 - x107*x111 - x13*x267*x62 + x267*x3*x4*x74 + x64*x68 + x65*x69 + x66*x70
	x270 = -x171*x255 + x184*x264 + x185*x265
	x271 = -x171*x251 + x184*x262 + x185*x263 + x270
	x272 = -x105*x114 - x106*x116 - x107*x118 + x145*x152 + x147*x153 + x149*x155 + x64*x76 + x65*x79 + x66*x82
	x273 = -x106*x121 - x107*x123 + x147*x158 + x149*x159 + x65*x85 + x66*x88
	x274 = -x107*x126 + x149*x162 + x66*x91
	x275 = x10**2*x5
	x276 = x266*x5
	x277 = Ix0*x164 + Iy0*x275 + Iz0*x276
	x278 = Ix1*x164 + Iy1*x276 + Iz1*x275
	x279 = Ix2*x201**2 + Iy2*x205**2 + Iz2*x275
	x280 = Ix3*x217**2 + Iy3*x222**2 + Iz3*x275
	x281 = Ixx*x164 + Iyy*x275 + Izz*x276
	x282 = Iz2*x171
	x283 = Ix2*x201
	x284 = Iy2*x205
	x285 = -x184*x282 + x202*x283 + x206*x284
	x286 = -x185*x282 + x203*x283 + x207*x284
	x287 = Iz3*x171
	x288 = Ix3*x217
	x289 = Iy3*x222
	x290 = -x184*x287 + x218*x288 + x223*x289
	x291 = -x185*x287 + x219*x288 + x224*x289
	x292 = Ix0*x8
	x293 = Iy0*x171
	x294 = Iz0*x151
	x295 = x13*x294 + x173*x293 - x25*x292
	x296 = x174*x293 - x292*x72 + x294*x74
	x297 = Ix1*x8
	x298 = Iz1*x171
	x299 = Iy1*x2*x4*x74 - x184*x298 - x297*x72
	x300 = Iy1*x13*x2*x4 - x185*x298 - x25*x297
	x301 = Ixx*x8
	x302 = Iyy*x171
	x303 = Izz*x151
	x304 = x13*x303 + x173*x302 - x25*x301
	x305 = x174*x302 - x301*x72 + x303*x74
	x306 = -x171*x280 + x184*x290 + x185*x291
	x307 = -x171*x279 + x184*x285 + x185*x286 + x306
	x308 = x109*x113 + x110*x115 + x111*x117 + x68*x75 + x69*x78 + x70*x81
	x309 = x110*x120 + x111*x122 + x69*x84 + x70*x87
	x310 = x111*x125 + x70*x90
	x311 = x184**2 + x185**2 + x275
	x312 = Iz1*x311
	x313 = x171*x312
	x314 = x186*x297
	x315 = -x10*x2*x5 + x13*x185 + x184*x74
	x316 = Iy1*x2*x315*x4 - x313 - x314
	x317 = Ix1*x186
	x318 = Iy1*x315
	x319 = x184*x312 + x317*x72 + x318*x74
	x320 = x13*x318 + x185*x312 + x25*x317
	x321 = Iz2*x311
	x322 = -x171*x201 + x184*x202 + x185*x203
	x323 = -x171*x205 + x184*x206 + x185*x207
	x324 = -x171*x321 + x283*x322 + x284*x323
	x325 = Ix2*x322
	x326 = Iy2*x323
	x327 = x184*x321 + x202*x325 + x206*x326
	x328 = x185*x321 + x203*x325 + x207*x326
	x329 = Iz3*x311
	x330 = -x171*x217 + x184*x218 + x185*x219
	x331 = -x171*x222 + x184*x223 + x185*x224
	x332 = -x171*x329 + x288*x330 + x289*x331
	x333 = Ix3*x330
	x334 = Iy3*x331
	x335 = x184*x329 + x218*x333 + x223*x334
	x336 = x185*x329 + x219*x333 + x224*x334
	x337 = x25*x336 - x332*x8 + x335*x72
	x338 = x25*x328 - x324*x8 + x327*x72 + x337
	x339 = -x1*x335 + x11*x336
	x340 = -x1*x327 + x11*x328 + x339
	x341 = x324 + x332
	x342 = -x171*x332 + x184*x335 + x185*x336
	x343 = -x171*x324 + x184*x327 + x185*x328 + x342
	x344 = x116*x120 + x118*x122 + x154*x158 + x156*x159 + x343 + x79*x84 + x82*x87
	x345 = x118*x125 + x156*x162 + x342 + x82*x90
	x346 = x123*x125 + x160*x162 + x342 + x88*x90

	Mq[0,0] = x0 
	Mq[0,1] = 0 
	Mq[0,2] = 0 
	Mq[0,3] = x60 
	Mq[0,4] = x67 
	Mq[0,5] = x71 
	Mq[0,6] = x83 
	Mq[0,7] = x89 
	Mq[0,8] = x91 
	Mq[1,0] = 0 
	Mq[1,1] = x0 
	Mq[1,2] = 0 
	Mq[1,3] = x104 
	Mq[1,4] = x108 
	Mq[1,5] = x112 
	Mq[1,6] = x119 
	Mq[1,7] = x124 
	Mq[1,8] = x126 
	Mq[2,0] = 0 
	Mq[2,1] = 0 
	Mq[2,2] = x0 
	Mq[2,3] = x140 
	Mq[2,4] = x150 
	Mq[2,5] = 0 
	Mq[2,6] = x157 
	Mq[2,7] = x161 
	Mq[2,8] = x163 
	Mq[3,0] = x60 
	Mq[3,1] = x104 
	Mq[3,2] = x140 
	Mq[3,3] = mL0*x129**2 + mL0*x15**2 + mL0*x93**2 + mL1*x132**2 + mL1*x29**2 + mL1*x96**2 + mL2*x135**2 + mL2*x43**2 + mL2*x99**2 + mL3*x102**2 + mL3*x138**2 + mL3*x58**2 - x179*x8 - x182*x8 - x189*x8 + x191*x25 + x192*x72 + x194*x25 + x195*x72 + x198*x72 + x199*x25 - x209*x8 + x210*x72 + x211*x25 - x226*x8 + x227*x72 + x228*x25 
	Mq[3,4] = -x1*x192 - x1*x195 - x1*x198 - x1*x210 - x1*x227 + x11*x191 + x11*x194 + x11*x199 + x11*x211 + x11*x228 + x229 
	Mq[3,5] = x151*x197 + x179 + x182 - x183 - x188 + x209 + x226 + x230 
	Mq[3,6] = -x171*x189 + x184*x198 + x185*x199 + x232 + x233 
	Mq[3,7] = x232 + x234 
	Mq[3,8] = x231 + x235 
	Mq[4,0] = x67 
	Mq[4,1] = x108 
	Mq[4,2] = x150 
	Mq[4,3] = x229 - x240*x8 - x244*x8 - x247*x8 + x25*x256 + x25*x259 + x25*x260 + x25*x263 + x25*x265 - x251*x8 - x255*x8 + x257*x72 + x258*x72 + x261*x72 + x262*x72 + x264*x72 
	Mq[4,4] = mL0*x143**2 + mL1*x144**2 + mL1*x165*x23**2 + mL1*x167*x24**2 + mL2*x146**2 + mL2*x165*x39**2 + mL2*x167*x40**2 + mL3*x148**2 + mL3*x165*x54**2 + mL3*x167*x55**2 - x1*x257 - x1*x258 - x1*x261 - x1*x262 - x1*x264 + x11*x256 + x11*x259 + x11*x260 + x11*x263 + x11*x265 + x166*x268 + x168*x268 
	Mq[4,5] = x240 + x244 + x247 + x251 + x255 + x269 
	Mq[4,6] = -x171*x244 + x184*x258 + x185*x259 + x271 + x272 
	Mq[4,7] = x271 + x273 
	Mq[4,8] = x270 + x274 
	Mq[5,0] = x71 
	Mq[5,1] = x112 
	Mq[5,2] = 0 
	Mq[5,3] = x230 + x25*x286 + x25*x291 + x25*x295 + x25*x300 + x25*x304 - x277*x8 - x278*x8 - x279*x8 - x280*x8 - x281*x8 + x285*x72 + x290*x72 + x296*x72 + x299*x72 + x305*x72 
	Mq[5,4] = -x1*x285 - x1*x290 - x1*x296 - x1*x299 - x1*x305 + x11*x286 + x11*x291 + x11*x295 + x11*x300 + x11*x304 + x269 
	Mq[5,5] = mL1*x28**2 + mL1*x95**2 + mL2*x42**2 + mL2*x98**2 + mL3*x101**2 + mL3*x57**2 + x13**2*x267 + x267*x74**2 + x277 + x278 + x279 + x280 + x281 
	Mq[5,6] = -x171*x278 + x184*x299 + x185*x300 + x307 + x308 
	Mq[5,7] = x307 + x309 
	Mq[5,8] = x306 + x310 
	Mq[6,0] = x83 
	Mq[6,1] = x119 
	Mq[6,2] = x157 
	Mq[6,3] = x233 + x25*x320 - x316*x8 + x319*x72 + x338 
	Mq[6,4] = -x1*x319 + x11*x320 + x272 + x340 
	Mq[6,5] = x151*x318 + x308 - x313 - x314 + x341 
	Mq[6,6] = mL1*x113**2 + mL1*x152**2 + mL1*x75**2 + mL2*x115**2 + mL2*x153**2 + mL2*x78**2 + mL3*x117**2 + mL3*x155**2 + mL3*x81**2 - x171*x316 + x184*x319 + x185*x320 + x343 
	Mq[6,7] = x344 
	Mq[6,8] = x345 
	Mq[7,0] = x89 
	Mq[7,1] = x124 
	Mq[7,2] = x161 
	Mq[7,3] = x234 + x338 
	Mq[7,4] = x273 + x340 
	Mq[7,5] = x309 + x341 
	Mq[7,6] = x344 
	Mq[7,7] = mL2*x120**2 + mL2*x158**2 + mL2*x84**2 + mL3*x122**2 + mL3*x159**2 + mL3*x87**2 + x343 
	Mq[7,8] = x346 
	Mq[8,0] = x91 
	Mq[8,1] = x126 
	Mq[8,2] = x163 
	Mq[8,3] = x235 + x337 
	Mq[8,4] = x274 + x339 
	Mq[8,5] = x310 + x332 
	Mq[8,6] = x345 
	Mq[8,7] = x346 
	Mq[8,8] = mL3*x125**2 + mL3*x162**2 + mL3*x90**2 + x342 


	return Mq